@model ELibraryManagement.Web.Models.BookViewModel
@using ELibraryManagement.Web.Services
@inject IAuthApiService AuthService
@{
    ViewData["Title"] = Model.Title;
}

@section Styles {
    <link rel="stylesheet" href="~/css/book-detail.css" />
}

<div class="book-detail-container">
    <div class="container py-5">
        <div class="row">
            <!-- Book Image -->
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="book-image-wrapper">
                    @if (!string.IsNullOrEmpty(Model.ImageUrl))
                    {
                        <img src="@Model.ImageUrl" alt="@Model.Title" class="book-image">
                    }
                    else
                    {
                        <div class="book-placeholder">
                            <i class="fas fa-book fa-4x"></i>
                            <p>Không có ảnh</p>
                        </div>
                    }

                    <div class="book-actions mt-3">
                        @if (AuthService.IsAuthenticated())
                        {
                            <a asp-controller="Book" asp-action="Borrow" asp-route-id="@Model.Id"
                                class="btn btn-primary btn-lg w-100 mb-2">
                                <i class="fas fa-book-open me-2"></i>
                                Mượn sách ngay
                            </a>
                        }
                        else
                        {
                            <a asp-controller="Account" asp-action="Login"
                                class="btn btn-outline-primary btn-lg w-100 mb-2">
                                <i class="fas fa-sign-in-alt me-2"></i>
                                Đăng nhập để mượn sách
                            </a>
                        }

                        <button class="btn btn-outline-secondary w-100" onclick="addToWishlist(@Model.Id)">
                            <i class="fas fa-heart me-2"></i>
                            Thêm vào yêu thích
                        </button>
                    </div>
                </div>
            </div>

            <!-- Book Information -->
            <div class="col-lg-8 col-md-6">
                <div class="book-info">
                    <h1 class="book-title">@Model.Title</h1>
                    <h3 class="book-author text-muted mb-3">@Model.Author</h3>

                    <div class="book-meta">
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <div class="meta-item">
                                    <i class="fas fa-tag text-primary"></i>
                                    <strong>Thể loại:</strong> @Model.CategoryName
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="meta-item">
                                    <i class="fas fa-barcode text-primary"></i>
                                    <strong>ISBN:</strong> <span class="isbn-value"
                                        title="@Model.ISBN">@Model.ISBN</span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <div class="meta-item">
                                    <i class="fas fa-calendar text-primary"></i>
                                    <strong>Năm xuất bản:</strong> @Model.PublicationYear
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="meta-item">
                                    <i class="fas fa-building text-primary"></i>
                                    <strong>Nhà xuất bản:</strong> @Model.Publisher
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <div class="meta-item">
                                    <i class="fas fa-file-alt text-primary"></i>
                                    <strong>Số trang:</strong> @Model.PageCount
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="meta-item">
                                    <i class="fas fa-gift text-success"></i>
                                    <strong>Trạng thái:</strong> <span class="text-success">Miễn phí mượn</span>
                                </div>
                            </div>
                        </div>

                        <div class="availability-status">
                            @if (Model.AvailableCopies > 0)
                            {
                                <span class="badge bg-success fs-6">
                                    <i class="fas fa-check-circle me-1"></i>
                                    Còn @Model.AvailableCopies bản
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-danger fs-6">
                                    <i class="fas fa-times-circle me-1"></i>
                                    Hết sách
                                </span>
                            }
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <div class="book-description mt-4">
                            <h4>Mô tả</h4>
                            <p class="description-text">@Model.Description</p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Related Books -->
        @if (ViewBag.RelatedBooks != null &&
                ((List<ELibraryManagement.Web.Models.BookViewModel>)ViewBag.RelatedBooks).Any())
        {
            <div class="related-books mt-5">
                <h3 class="section-title">
                    <i class="fas fa-books me-2"></i>
                    Sách liên quan
                </h3>
                <div class="row">
                    @foreach (var relatedBook in (List<ELibraryManagement.Web.Models.BookViewModel>)ViewBag.RelatedBooks)
                    {
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                            <div class="card book-card h-100">
                                <div class="book-card-image">
                                    @if (!string.IsNullOrEmpty(relatedBook.ImageUrl))
                                    {
                                        <img src="@relatedBook.ImageUrl" alt="@relatedBook.Title" class="card-img-top">
                                    }
                                    else
                                    {
                                        <div class="card-placeholder">
                                            <i class="fas fa-book"></i>
                                        </div>
                                    }
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h6 class="card-title">@relatedBook.Title</h6>
                                    <p class="card-text text-muted small">@relatedBook.Author</p>
                                    <div class="mt-auto">
                                        <a asp-controller="Book" asp-action="Details" asp-route-id="@relatedBook.Id"
                                            class="btn btn-outline-primary btn-sm w-100">
                                            Xem chi tiết
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function addToWishlist(bookId) {
            // Implement wishlist functionality later
            alert('Tính năng yêu thích đang được phát triển!');
        }
    </script>
}
